<!DOCTYPE html>

<html lang="en">
<head>
  <title>Profile Page</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="styles/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="JS/signup.js"></script>
  <script type="text/javascript" src="JS/Style.js"></script>
  <script type="text/javascript" src="JS/navBar.js"></script>
   
  <!-- update the version number as needed -->
    <script defer src="/__/firebase/4.13.0/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/4.13.0/firebase-auth.js"></script>
    <script defer src="/__/firebase/4.13.0/firebase-database.js"></script>
    <script defer src="/__/firebase/4.13.0/firebase-messaging.js"></script>
    <script defer src="/__/firebase/4.13.0/firebase-storage.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
    
    <link rel="stylesheet" type="text/css" media="screen" href="styles/style.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="styles/navBar.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="styles/iphone.css" />
    <style media="screen"></style>
</head>
<body>

<div id="wrap">
        <nav class="navbar navbar-inverse">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar" style="width:40px;"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="index.html">ColorSizeMe</a> </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#">About</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                    <ul id="loginTable" class="nav navbar-nav navbar-right">
                        <li id="login" onclick="loginFunction()">Log In</li>
                        <li id="messageText0">
                            <p></p>
                        </li>
                        <li id="signup" onclick="signupFunction()">Sign Up</li>
                        <li id="messageText1">
                            <p></p>
                        </li>
                        <li>
                            <div id="accountMenu" onclick="location.href='myprofile.html';"> <img id="accountImage" src="">
                                <!--
                                    <div class="dropDownSign"></div>
                                    <ul id="menu">
                                        <li>
                                            <a id="accountMenu" href="#"><img id="accountImage" src=""><div class="dropDownSign"/></a>
                                            <a href="#">Categories</a>
                                            <ul>
                                                <li><a href="#">CSS</a></li>
                                                <li><a href="#">Graphic design</a></li>
                                                <li><a href="#">Development tools</a></li>
                                                <li><a href="#">Web design</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                  --></div>
                        </li>
                        <li id="logout" class="buttons" onclick="logoutFunction()">Log Out</li>
                    </ul>
                </div>
            </div>
        </nav>
</div>

<img src="" alt="Avatar" width="200" height="200" id="avatar" style="display:none;">

<br>

<div class="form-group">
  <label for="fname" style="display:none;">First Name: </label>  
  <span id ="firstname"></span>
  <input id="fname" name="fname" type="text" value="" style="display:none;">
  <span class="help-block" id="invalid_fname" style="color:red;display: none;">Name can only contains alphabetic characters.</span>   
</div>

<div class="form-group">
  <label for="lname" style="display:none;">Last Name: </label>  
  <span id ="lastname"></span>
  <input id="lname" name="lname" type="text" value="" style="display:none;">
  <span class="help-block" id="invalid_lname" style="color:red;display: none;">Name can only contains alphabetic characters.</span>   
</div>

<div class="form-group">
  <label id="un" for="username" style="display:none;">Username: </label>  
  <span id ="uname"></span>
  <input id="username" name="uname" type="text" value="" style="display:none;">
  <span class="help-block" id="invalid_username" style="display:inline;"></span><span id="symbol" style="display:inline;"></span>   
</div>

<div class="form-group">
  <label for="towncity" style="display:none;">City/Town: </label>  
  <span id ="citytown"></span>
  <input id="towncity" name="towncity" type="text" value="" style="display:none;">
  <span class="help-block" id="invalid_loc1" style="color:red;display: none;">Type in city/town</span>    
</div>


<div class="form-group">
  <label for="country" style="display:none;">Country: </label>  
  <span id ="ctry"></span>
  <input id="country" name="country" type="text" value="" style="display:none;">
  <span class="help-block" id="invalid_loc2" style="color:red;display: none;">Type in country</span>    
</div>

<script>
var firstname;
var lastname;
var username;
var photo;
var city;
var country;
var visibility;

var db;
var uid;
var storageRef;

var refreshIntervalId  = window.setInterval(loadProfile, 500);

if (typeof firebase != 'undefined')
  clearInterval(refreshIntervalId);
    
function loadProfile() {
  db = firebase.database(); 
  uid = document.cookie; 
  storageRef = firebase.storage().ref();

  db.ref('/users/' + uid).once('value').then(function(snapshot) {
    visibility = snapshot.val().visibility;
  });
  
  if (visibility == "public") {
    $('label').show();
    
    db.ref('/users/' + uid + '/public_use').once('value').then(function(snapshot) {
      firstname = snapshot.val().firstname;
      lastname = snapshot.val().lastname;
      username = snapshot.val().username;
      photo = snapshot.val().profilepic;
      city = snapshot.val().citytown;
      country = snapshot.val().country;
    
      document.getElementById("firstname").innerHTML = firstname;
      document.getElementById("lastname").innerHTML = lastname;
      document.getElementById("uname").innerHTML = username;
      document.getElementById("citytown").innerHTML = city;
      document.getElementById("ctry").innerHTML = country;    
    });
  }
  
  if (visibility == "private") {
    $('#un').show();
    
    db.ref('/users/' + uid + '/private_use').once('value').then(function(snapshot) {
      username = snapshot.val().username;      
      document.getElementById("uname").innerHTML = username;      
    });    
  }
  
  if (photo == "yes") {
    storageRef.child('profilePictures/' + uid + '.jpg').getDownloadURL().then(function(url) { 
      var path = url;       
      document.getElementById("avatar").src = path;
    }).catch(function(error) { });
  } else {
    storageRef.child('profilePictures/anonymous-avatar-sm.jpg').getDownloadURL().then(function(url) {
      var path = url;
      document.getElementById("avatar").src = path;
    }).catch(function(error) { });
  }
  $("#avatar").show();
}

</script>

</body>

</html> 
 